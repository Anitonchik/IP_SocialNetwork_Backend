package com.example.SocialNetwork.api.Chat;

import com.example.SocialNetwork.api.NotFoundException;
import com.example.SocialNetwork.api.User.UserController;
import com.example.SocialNetwork.api.User.UserDTO;
import com.example.SocialNetwork.chatType;
import com.example.SocialNetwork.configuration.Constants;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.web.bind.annotation.*;

import java.util.ArrayList;
import java.util.Date;
import java.util.List;
import java.util.concurrent.CopyOnWriteArrayList;
import java.util.concurrent.atomic.AtomicInteger;
import java.util.stream.Collectors;

import static java.util.stream.Collectors.toList;

@RestController
@RequestMapping(Constants.API_URL + ChatController.URL)
public class ChatController {
    public static final String URL = "/chats";
    private final Logger log = LoggerFactory.getLogger(UserController.class);
    private final AtomicInteger idGenerator = new AtomicInteger();
    private List<ChatDTO> chats = new CopyOnWriteArrayList<>();
    private UserController userController;
    private MessageController messageController;

    public ChatController(UserController userController, MessageController messageController) {
        this.messageController = messageController;

        this.chats = new ArrayList<>(List.of(
                new ChatDTO(idGenerator.incrementAndGet(), "Band", "data:image/jpeg;base64,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",
                        chatType.GROUP, new Date(), new ArrayList<>(List.of(1, 2, 3))),
                new ChatDTO(idGenerator.incrementAndGet(), "bebebe", "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTVp6S4da1FNIGZ-6ZPf95JljC6QbtJXIB56g&s",
                        chatType.GROUP, new Date(), new ArrayList<>(List.of(1, 2, 3))),
                new ChatDTO(idGenerator.incrementAndGet(), "ufufuf", "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTt6jKEnWDBF5kqYD-S_gCrf1xGU_fcdu11eg&s",
                        chatType.GROUP, new Date(), new ArrayList<>(List.of(1, 2, 3)))));

        chats.forEach(chat -> chat.setMessages(messageController.getMessagesByChat(chat.getId())));

        this.userController = userController;
    }

    @GetMapping("/userschats/{userId}")
    public List<ChatDTO> getMethodName(@PathVariable int userId) {
        log.debug("Get all user's chats");
        var d = chats.stream().filter(chat -> chat.getParticipants().contains(userId)).toList();
        return d;
    }

    @GetMapping("/{id}")
    public ChatDTO get(@PathVariable int id) {
        log.debug("Get user wtih id {}", id);
        return chats.stream()
                .filter(chat -> chat.getId() == id)
                .findAny()
                .orElseThrow(() -> new NotFoundException(UserDTO.class, id));
    }

    @PostMapping
    public ChatDTO create(@RequestBody ChatDTO newChat) {
        log.debug("Create chat with data {}", newChat);
        newChat.setId(idGenerator.incrementAndGet());
        chats.add(newChat);
        return newChat;
    }

    @PutMapping("/{id}")
    public ChatDTO edit(@PathVariable int id, @RequestBody ChatDTO newChat) {
        log.debug("Edit chat with id {} and data {}", id, newChat);
        final ChatDTO existsChat = get(id);
        existsChat.setChatName(newChat.getChatName());
        existsChat.setParticipants(newChat.getParticipants());
        return existsChat;
    }

    @DeleteMapping("/{id}")
    public ChatDTO delete(@PathVariable int id) {
        log.debug("Delete chat with id {}", id);
        final ChatDTO chat = get(id);
        chats.remove(chat);
        return chat;
    }
}
